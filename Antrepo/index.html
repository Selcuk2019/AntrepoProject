<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Antrepo Yönetimi</title>
  <!-- Prevent caching -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <!-- Plotly CDN -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <!-- style.css: Kök dizinde css klasöründe -->
  <link rel="stylesheet" href="css/style.css" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  
  <!-- DataTables CSS -->
  <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap5.min.css" rel="stylesheet">

  <!-- Dashboard Kartları İçin Özel Stiller -->
  <style>
    .dashboard-cards {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 30px;
    }

    .dashboard-cards .card {
      flex: 1 0 calc(33.333% - 20px);
      min-width: 300px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: transform 0.2s, box-shadow 0.2s;
      height: 160px; /* Sabit yükseklik */
      overflow: hidden;
      position: relative;
      border-left: 5px solid #3F51B5;
    }

    .dashboard-cards .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }

    .dashboard-cards .card h2 {
      color: #555;
      font-size: 18px;
      font-weight: 600;
      margin-top: 0;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #f0f0f0;
      height: 50px; /* Başlık için sabit yükseklik */
      display: flex;
      align-items: center;
    }

    .dashboard-cards .card .card-value {
      font-size: 28px;
      font-weight: 700;
      color: #3F51B5;
      margin-top: auto;
      text-align: right;
      letter-spacing: -0.5px;
    }

    /* Kartlara renk çeşitliliği ekleyelim */
    .dashboard-cards .card:nth-child(1) {
      border-left-color: #3F51B5;
    }
    .dashboard-cards .card:nth-child(1) .card-value {
      color: #3F51B5;
    }
    .dashboard-cards .card:nth-child(2) {
      border-left-color: #4CAF50;
    }
    .dashboard-cards .card:nth-child(2) .card-value {
      color: #4CAF50;
    }
    .dashboard-cards .card:nth-child(3) {
      border-left-color: #FF9800;
    }
    .dashboard-cards .card:nth-child(3) .card-value {
      color: #FF9800;
    }
    .dashboard-cards .card:nth-child(4) {
      border-left-color: #E91E63;
    }
    .dashboard-cards .card:nth-child(4) .card-value {
      color: #E91E63;
    }
    .dashboard-cards .card:nth-child(5) {
      border-left-color: #673AB7;
    }
    .dashboard-cards .card:nth-child(5) .card-value {
      color: #673AB7;
    }
    .dashboard-cards .card:nth-child(6) {
      border-left-color: #00BCD4;
    }
    .dashboard-cards .card:nth-child(6) .card-value {
      color: #00BCD4;
    }

    @media (max-width: 1200px) {
      .dashboard-cards .card { flex: 1 0 calc(50% - 20px); }
    }
    @media (max-width: 768px) {
      .dashboard-cards .card { flex: 1 0 100%; }
    }

    /* Ana sayfa hoş geldiniz bölümü için ek stiller */
    .welcome-section {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      border-radius: 12px;
      padding: 20px; /* Dikey boyutu daraltmak için padding azaltıldı (30px'ten 20px'e) */
      margin-bottom: 20px; /* Margin de azaltıldı (30px'ten 20px'e) */
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      text-align: center;
      position: relative;
      overflow: hidden;
      border-top: 5px solid #3F51B5;
    }
    
    .welcome-section:before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXR0ZXJuIGlkPSJwYXR0ZXJuIiB4PSIwIiB5PSIwIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiIHBhdHRlcm5UcmFuc2Zvcm09InJvdGF0ZSgzMCkiPjxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSIyIiBoZWlnaHQ9IjIiIGZpbGw9IiMzRjUxQjUiIG9wYWNpdHk9IjAuMDMiLz48L3BhdHRlcm4+PHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0idXJsKCNwYXR0ZXJuKSIvPjwvc3ZnPg==');
      opacity: 0.8;
      z-index: 0;
    }

    .welcome-section h1 {
      color: #2C3E50;
      font-size: 1.8rem; /* Başlık boyutu küçültüldü (2.2rem'den 1.8rem'e) */
      font-weight: 700;
      margin-bottom: 8px; /* Margin azaltıldı (12px'ten 8px'e) */
      position: relative;
      z-index: 1;
    }

    .welcome-section p {
      color: #5D6D7E;
      font-size: 1rem; /* Metin boyutu küçültüldü (1.1rem'den 1rem'e) */
      line-height: 1.5;
      max-width: 700px;
      margin: 0 auto 15px; /* Margin azaltıldı (20px'ten 15px'e) */
      position: relative;
      z-index: 1;
    }

    .welcome-section .dashboard-summary {
      font-size: 0.95rem;
      color: #7F8C8D;
      margin-bottom: 10px; /* Margin azaltıldı (15px'ten 10px'a) */
      position: relative;
      z-index: 1;
    }

    .feature-icons {
      display: flex;
      justify-content: center;
      gap: 30px; /* Gap azaltıldı (40px'ten 30px'a) */
      margin: 15px 0; /* Margin azaltıldı (25px'ten 15px'e) */
      position: relative;
      z-index: 1;
    }

    .feature-icon {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #34495E;
    }

    .feature-icon i {
      font-size: 1.8rem; /* İkon boyutu küçültüldü (2rem'den 1.8rem'e) */
      margin-bottom: 6px; /* Margin azaltıldı (8px'ten 6px'ya) */
      color: #3F51B5;
    }

    .feature-icon span {
      font-size: 0.9rem;
      font-weight: 500;
    }

    .welcome-action {
      margin-top: 20px;
      position: relative;
      z-index: 1;
    }

    .btn-get-started {
      background: linear-gradient(135deg, #3F51B5 0%, #303F9F 100%);
      color: white;
      padding: 12px 24px;
      border-radius: 30px;
      font-size: 1rem;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(63, 81, 181, 0.2);
    }

    .btn-get-started:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 10px rgba(63, 81, 181, 0.3);
    }
  </style>
</head>
<body>
  <!-- Üst Bar (doğrudan kodlanmış) -->
  <header class="topbar">
    <div class="topbar-left">
      <span class="logo">ANTREPO</span>
    </div>
    <div class="topbar-right">
      <input type="text" placeholder="Ara..." class="topbar-search" />
      <img src="assets/user-icon.png" alt="User Icon" class="topbar-user-icon" />
    </div>
  </header>

  <div class="main-container">
    <!-- Sol Sidebar (doğrudan kodlanmış) -->
    <nav class="sidebar">
      <ul>
        <li><a href="index.html" class="active">Anasayfa</a></li>
        <li><a href="pages/warehouse-entry-form.html">Antrepo Giriş Formu</a></li>
        <li><a href="pages/company-list.html">Antrepo Şirket Listesi</a></li>
        <li><a href="pages/product-list.html">Ürünler</a></li>
      </ul>
    </nav>

    <!-- İçerik Alanı -->
    <div class="content">
      <!-- Hoş Geldiniz Bölümü - Güncellendi -->
      <div class="welcome-section">
        <h1>Antrepo Yönetim Sisteminize Hoş Geldiniz</h1>
        <p>Antrepo işlemlerinizi kolayca takip edin, stok durumlarını anlık izleyin ve maliyetlerinizi optimize edin.</p>
        <div class="dashboard-summary">Bugün <strong id="aktifAntrepoSayisi">0</strong> antrepo ve <strong id="toplamUrunSayisi">0</strong> ürün sisteminizde kayıtlı.</div>
        
        <div class="feature-icons">
          <div class="feature-icon">
            <i class="fas fa-warehouse"></i>
            <span>Antrepo Takibi</span>
          </div>
          <div class="feature-icon">
            <i class="fas fa-boxes"></i>
            <span>Stok Yönetimi</span>
          </div>
          <div class="feature-icon">
            <i class="fas fa-chart-line"></i>
            <span>Maliyet Analizi</span>
          </div>
          <div class="feature-icon">
            <i class="fas fa-file-contract"></i>
            <span>Sözleşme Yönetimi</span>
          </div>
        </div>
        
        <!-- Başlat butonu yorum içine alındı -->
        <!--
        <div class="welcome-action">
          <button class="btn-get-started">Başlayın <i class="fas fa-arrow-right"></i></button>
        </div>
        -->
      </div>

      <!-- 6 adet KPI / Dashboard Kartı -->
      <div class="dashboard-cards">
        <div class="card">
          <h2>Tüm Antrepolar Toplam Stok</h2>
          <span class="card-value" id="totalStockValue">--</span>
        </div>
        <div class="card">
          <h2>Tüm Antrepolar Toplam Kap</h2>
          <span class="card-value" id="totalKapValue">--</span>
        </div>
        <div class="card">
          <h2>Giriş Formları Gün Maliyeti</h2>
          <span class="card-value" id="dailyCostValue">--</span>
        </div>
        <div class="card">
          <h2>Giriş Formları Toplam Maliyet</h2>
          <span class="card-value" id="totalCostValue">--</span>
        </div>
        <div class="card">
          <h2>Aktif Giriş Formu Adeti</h2>
          <span class="card-value" id="activeFormCountValue">--</span>
        </div>
        <div class="card">
          <h2>Tüm Antrepolardaki Ürün Kalemi</h2>
          <span class="card-value" id="productVarietyCountValue">--</span>
        </div>
      </div>

      <!-- 3 Sütunlu Chart Row -->
      <div class="charts-row">
        <div class="chart-col">
          <h2>Envanter Taşıma Maliyeti</h2>
          <div class="chart-box" id="chartInventoryCost"></div>
        </div>
        <div class="chart-col">
          <h2>Envanter Devir Oranı</h2>
          <div class="chart-box" id="chartTurnoverRatio"></div>
        </div>
        <div class="chart-col">
          <h2>Stok-Satış Oranı</h2>
          <div class="chart-box" id="chartSalesRatio"></div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
    <!-- Template JS -->
  <script src="js/template.js?v=3"></script>
  <script>
        const template = new Template();
        template.init();
  </script>

  <!-- Dashboard Charts JS -->
  <script src="js/dashboard-charts.js"></script>
  <!-- Dashboard Data JS - type="module" eklenmeli -->
  <script src="js/dashboard.js" type="module"></script>
  <!-- Antrepo ve Ürün Sayısını Güncelleyen Script -->
  <script type="module">
    import { baseUrl, fetchWithAuth } from './js/config.js';
    
    // Sayfa yüklendiğinde antrepo ve ürün sayılarını al
    document.addEventListener('DOMContentLoaded', async function() {
      // Aktif antrepo sayısını getir
      try {
        const antrepoData = await fetchWithAuth(`${baseUrl}/api/antrepolar`);
        // Sadece aktif olan antrepoları say
        const aktifAntrepoSayisi = antrepoData.filter(antrepo => antrepo.aktif === 1).length;
        document.getElementById('aktifAntrepoSayisi').textContent = aktifAntrepoSayisi;
      } catch (error) {
        console.error('Antrepo verisi alınamadı:', error);
      }
      
      // Toplam ürün sayısını getir
      try {
        const urunData = await fetchWithAuth(`${baseUrl}/api/urunler`);
        const toplamUrunSayisi = urunData.length;
        document.getElementById('toplamUrunSayisi').textContent = toplamUrunSayisi;
      } catch (error) {
        console.error('Ürün verisi alınamadı:', error);
      }
    });
  </script>
</body>
</html>
